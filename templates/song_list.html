<html>
    <head>
        <title>Amit Lohe</title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <!--<link rel="stylesheet" href="./static/styles/style.css" >-->

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script type="text/javascript">

            //ajax to check for new song every 5 seconds
            let token = "{{ token }}"

            
            //get request to retrieve new song data
            function getSong() {
                $.ajax({
                    url: "https://api.spotify.com/v1/me/player/currently-playing",
                    type: "GET",
                    beforeSend: function(xhr){xhr.setRequestHeader('Authorization', 'Bearer ' + token );},
                    complete: function(x, y) {
                        if(y == 'nocontent') {
                            var message = "<p>You currently have no song playing.</p>"
                            $('#current-song').html(message)
                        }
                    },
                    success: function(data) {
                        console.log(data)
                        if(data) {
                            if(data['is_playing'] == false) {
                                var message = "<p>You currently have no song playing.</p>"
                                $('#current-song').html(message)
                            } else {
                                name = data['item']['name']
                                uri = data['item']['uri']
                                id = data['item']['id']
                                var message = '<p>'+ name +'</p><p>'+ uri +'</p><p>'+ id +'</p>'
                                $('#current-song').html(message)
                            }
                        }
                        
                    }
                    // if curr song is diff from previous song
                    // play that song via the playSong function below
                });
            }
            //setting interval of 5 seconds
            window.setInterval(function() { getSong() }, 5000);

            getSong();
            playSong();
            function playSong() {
                let device_id = "{{ device_id }}"
                let playlist_id = "{{ playlist_id }}"
                let user_uri = "{{ user_uri }}"
                let context_uri = ""+user_uri+':playlist:'+ playlist_id;
                $.ajax({
                    url: "https://api.spotify.com/v1/me/player/play?device_id=" + device_id,
                    type: "PUT",
                    data: "{\"context_uri\":\""+context_uri+"\"}",
                    beforeSend: function(xhr){xhr.setRequestHeader('Authorization', 'Bearer ' + token );},
                    complete: function(x, y) {
                        console.log(user_uri)
                        console.log(context_uri);
                        console.log('-')
                        console.log(y)

                    },
                    success: function(data) { 
                        console.log('playing')
                        console.log('------')
                        console.log(data)
                        console.log('------')
                    }
                });
            }
            


        </script>
    </head>
    <body>
        <br/>
        <div class="container container-fluid">
            <div class="row justify-content-center">
                    <div class="col-md-8">
                        <h1 id="name"><a href="/">Amit Lohe</a></h1>
                        <hr>
                    </div>
            </div>
        </div>
        <div class="container container-fluid">
            <!-- div used to hold info about current song  --> 
            <div id="current-song">
            </div>
        </div>
        <div class="container-fluid">
            <!-- the SDK wasn't appearing in a user's devices all the time, so for now let's not use it, but we should probably figure it out  --> 
            <!-- Spotify Web Player SDK code from their website --> 
            <!--
            <script src="https://sdk.scdn.co/spotify-player.js"></script>
            <script>
                window.onSpotifyWebPlaybackSDKReady = () => {
                    // You can now initialize Spotify.Player and use the SDK
                    const token = "{{ token }}";
                    const player = new Spotify.Player({ name: 'Web Playback SDK Quick Start Player', getOAuthToken: cb => { cb(token); } });
                    player.connect();
                }              
            </script>
            -->

            <script type="text/javascript">
                
            </script>
        </div>
        <div class="container container-fluid">
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <hr>
                    <p class="text-center">Made with ❤️ in Philadelphia.</p>
                </div>
            </div>
        </div>
    </body>
</html>
